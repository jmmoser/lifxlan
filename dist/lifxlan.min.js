var N=56700,JJ="255.255.255.255",zQ="https://raw.githubusercontent.com/LIFX/products/master/products.json",k=new Uint8Array([0,0,0,0,0,0]),GQ={UDP:1,RESERVED2:2,RESERVED3:3,RESERVED4:4,RESERVED5:5},DQ={RIGHT:0,LEFT:1},CQ={SUCCESS:0,BUSY:1,INTERRUPTED_BY_RESET:2,INTERRUPTED_BY_HOMEKIT:3,INTERRUPTED_BY_LAN:4,INTERRUPTED_BY_CLOUD:5,NONE:255},qQ={NO_APPLY:0,APPLY:1,APPLY_ONLY:2},LQ={OFF:0,MOVE:1,RESERVED1:2,RESERVED2:3},BQ={NO_APPLY:0,APPLY:1,APPLY_ONLY:2},HQ={OFF:0,RESERVED1:1,MORPH:2,FLAME:3,RESERVED2:4,SKY:5},AQ={SUNRISE:0,SUNSET:1,CLOUDS:2},OQ={SAW:0,SINE:1,HALF_SINE:2,TRIANGLE:3,PULSE:4},U={GetService:2,StateService:3,GetHostFirmware:14,StateHostFirmware:15,GetWifiInfo:16,StateWifiInfo:17,GetWifiFirmware:18,StateWifiFirmware:19,GetPower:20,SetPower:21,StatePower:22,GetLabel:23,SetLabel:24,StateLabel:25,GetVersion:32,StateVersion:33,GetInfo:34,StateInfo:35,SetReboot:38,Acknowledgement:45,GetLocation:48,SetLocation:49,StateLocation:50,GetGroup:51,SetGroup:52,StateGroup:53,EchoRequest:58,EchoResponse:59,StateUnhandled:223,GetColor:101,SetColor:102,SetWaveform:103,LightState:107,GetLightPower:116,SetLightPower:117,StateLightPower:118,SetWaveformOptional:119,GetInfrared:120,StateInfrared:121,SetInfrared:122,GetHevCycle:142,SetHevCycle:143,StateHevCycle:144,GetHevCycleConfiguration:145,SetHevCycleConfiguration:146,StateHevCycleConfiguration:147,GetLastHevCycleResult:148,StateLastHevCycleResult:149,SetColorZones:501,GetColorZones:502,StateZone:503,StateMultiZone:506,GetMultiZoneEffect:507,SetMultiZoneEffect:508,StateMultiZoneEffect:509,SetExtendedColorZones:510,GetExtendedColorZones:511,StateExtendedColorZones:512,GetRPower:816,SetRPower:817,StateRPower:818,GetDeviceChain:701,StateDeviceChain:702,SetUserPosition:703,Get64:707,State64:711,Set64:715,GetTileEffect:718,SetTileEffect:719,StateTileEffect:720,SensorGetAmbientLight:401,SensorStateAmbientLight:402};function S(Q,J,$,Z,W,X,K,F){let z=36+(F!=null?F.byteLength:0),G=new Uint8Array(z),D=new DataView(G.buffer,G.byteOffset);if(D.setUint16(0,z,!0),D.setUint16(2,5120|+Q<<13|0,!0),D.setUint32(4,J,!0),G.set($,8),D.setUint8(22,(Z?1:0)<<0|(W?1:0)<<1),D.setUint8(23,X),D.setUint16(32,K,!0),F)G.set(F,36);return G}function QJ(Q,J,$){let Z=$.replace(/-/g,"");for(let W=0,X=0;W<Z.length;W+=2,X++)Q[J+X]=parseInt(Z.slice(W,W+2),16)}var rJ=new TextEncoder;function b(Q,J,$,Z){if(rJ.encodeInto($,Q.subarray(J)),$.length<Z)Q[J+$.length]=0}function $J(Q,J){let $=new Uint8Array(J);return b($,0,Q,J),$}function q(Q,J,$){let Z=Q.subarray(J.current,J.current+$);return J.current+=$,Z}function iJ(Q,J){return Array.from(q(Q,J,16)).map(($)=>$.toString(16).padStart(2,"0")).join("")}var oJ=new TextDecoder;function x(Q,J,$){let Z=Q.subarray(J.current,J.current+$).findIndex((K)=>K===0),W=Z>=0?Z:$,X=oJ.decode(Q.subarray(J.current,J.current+W));return J.current+=$,X}function ZJ(Q,J,$){Q.setBigUint64(J,BigInt($.getTime())*1000000n,!0)}function M(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=new Date(Number($.getBigUint64(J.current,!0)/1000000n));return J.current+=8,Z}function WJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint32(J.current,!0);return J.current+=4,{service:Z,port:W}}function VJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=M(Q,J),W=q(Q,J,8),X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);return J.current+=2,{build:Z,reserved:W,version_minor:X,version_major:K}}function YJ(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getFloat32(J.current,!0);J.current+=4;let W=q(Q,J,4),X=q(Q,J,4),K=q(Q,J,2);return{signal:Z,reserved6:W,reserved7:X,reserved8:K}}function KJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),Z=M(Q,J),W=q(Q,J,8),X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);return J.current+=2,{build:Z,reserved6:W,version_minor:X,version_major:K}}function p(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,Z}function c(Q,J){return x(Q,J,32)}function XJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint32(J.current,!0);J.current+=4;let W=$.getUint32(J.current,!0);return J.current+=4,{vendor:Z,product:W}}function FJ(Q,J){let $=M(Q,J),Z=M(Q,J),W=M(Q,J);return{time:$,uptime:Z,downtime:W}}function u(Q,J){let $=q(Q,J,16),Z=x(Q,J,32),W=M(Q,J);return{location:$,label:Z,updated_at:W}}function v(Q,J){let $=iJ(Q,J),Z=x(Q,J,32),X=new DataView(Q.buffer,Q.byteOffset).getBigUint64(J.current,!0);return J.current+=8,{group:$,label:Z,updated_at:X}}function PJ(Q,J){return q(Q,J,64)}function UJ(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,Z}function jQ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=q(Q,J,1),W=$.getUint16(J.current,!0);J.current+=2;let X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);J.current+=2;let F=$.getUint16(J.current,!0);J.current+=2;let V=$.getUint32(J.current,!0);return J.current+=4,{reserved:Z,hue:W,saturation:X,brightness:K,kelvin:F,duration:V}}function zJ(Q,J,$,Z,W){let X=new Uint8Array(13),K=new DataView(X.buffer);return K.setUint16(1,Q,!0),K.setUint16(3,J,!0),K.setUint16(5,$,!0),K.setUint16(7,Z,!0),K.setUint32(9,W,!0),X}function GJ(Q){let J=new Uint8Array(2);return new DataView(J.buffer).setUint16(0,typeof Q==="number"?Q:Q?65535:0,!0),J}function DJ(Q,J,$){let Z=new Uint8Array(56),W=new DataView(Z.buffer);if(typeof Q==="string")QJ(Z,0,Q);else Z.set(Q,0);return b(Z,16,J,32),ZJ(W,48,$),Z}function CJ(Q,J,$){let Z=new Uint8Array(56),W=new DataView(Z.buffer);if(typeof Q==="string")QJ(Z,0,Q);else Z.set(Q,0);return b(Z,16,J,32),ZJ(W,48,$),Z}function qJ(Q){let J=new Uint8Array(64);return J.set(Q),J}function LJ(Q,J,$,Z,W,X,K,F,V){let Y=new Uint8Array(21),P=new DataView(Y.buffer);return Y[1]=Q?1:0,P.setUint16(2,J,!0),P.setUint16(4,$,!0),P.setUint16(6,Z,!0),P.setUint16(8,W,!0),P.setUint32(10,X,!0),P.setFloat32(14,K,!0),P.setInt16(18,F,!0),P.setUint8(20,V),Y}function BJ(Q,J){let $=new Uint8Array(6),Z=new DataView($.buffer),W=typeof Q==="number"?Q:Q?65535:0;return Z.setUint16(0,W,!0),Z.setUint32(2,J,!0),$}function HJ(Q,J,$,Z,W,X,K,F,V,Y,P,z,G){let D=new Uint8Array(25),C=new DataView(D.buffer);return D[1]=Q?1:0,C.setUint16(2,J,!0),C.setUint16(4,$,!0),C.setUint16(6,Z,!0),C.setUint16(8,W,!0),C.setUint32(10,X,!0),C.setFloat32(14,K,!0),C.setInt16(18,F,!0),C.setUint8(20,V),D[21]=Y?1:0,D[22]=P?1:0,D[23]=z?1:0,D[24]=G?1:0,D}function AJ(Q){let J=new Uint8Array(2);return new DataView(J.buffer).setUint16(0,Q,!0),J}function OJ(Q,J){let $=new Uint8Array(5),Z=new DataView($.buffer);return Z.setUint8(0,Q?1:0),Z.setUint32(1,J,!0),$}function MJ(Q,J){let $=new Uint8Array(5),Z=new DataView($.buffer);return Z.setUint8(0,Q?1:0),Z.setUint32(1,J,!0),$}function jJ(Q){let J=new Uint8Array(1);return new DataView(J.buffer).setUint8(0,Q),J}function EJ(Q,J){let $=new Uint8Array(3),Z=new DataView($.buffer);return Z.setUint8(0,Q),Z.setUint16(1,J,!0),$}function IJ(Q,J,$,Z,W){let X=new Uint8Array(6),K=new DataView(X.buffer);return K.setUint8(0,Q),K.setUint8(1,J),K.setUint8(2,0),K.setUint8(3,$),K.setUint8(4,Z),K.setUint8(5,W),X}function SJ(Q,J){let $=new Uint8Array(2),Z=new DataView($.buffer);return Z.setUint8(0,Q),Z.setUint8(1,J),$}function _J(Q,J,$,Z,W,X,K,F){let V=new Uint8Array(15),Y=new DataView(V.buffer);return Y.setUint8(0,Q),Y.setUint8(1,J),Y.setUint16(2,$,!0),Y.setUint16(4,Z,!0),Y.setUint16(6,W,!0),Y.setUint16(8,X,!0),Y.setUint32(10,K,!0),Y.setUint8(14,F),V}function NJ(Q,J,$,Z,W){let X=new Uint8Array(59),K=new DataView(X.buffer);return K.setUint32(0,Q,!0),K.setUint8(4,J),K.setUint8(5,0),K.setUint8(6,0),K.setUint32(7,$,!0),K.setBigUint64(11,Z,!0),K.setUint32(19,0),K.setUint32(23,0),X.set(W.slice(0,32),27),X}function kJ(Q,J,$,Z,W){let X=new Uint8Array(664),K=new DataView(X.buffer);K.setUint32(0,Q,!0),K.setUint8(4,J),K.setUint16(5,$,!0),K.setUint8(7,Z);for(let F=0;F<82;F++){let V=W[F]||{hue:0,saturation:0,brightness:0,kelvin:0},Y=8+F*8;K.setUint16(Y,V.hue,!0),K.setUint16(Y+2,V.saturation,!0),K.setUint16(Y+4,V.brightness,!0),K.setUint16(Y+6,V.kelvin,!0)}return X}function xJ(Q,J,$){let Z=new Uint8Array(11),W=new DataView(Z.buffer);return W.setUint8(0,Q),W.setUint8(1,0),W.setUint8(2,0),W.setFloat32(3,J,!0),W.setFloat32(7,$,!0),Z}function TJ(Q,J,$,Z,W,X,K){let F=new Uint8Array(522),V=new DataView(F.buffer);V.setUint8(0,Q),V.setUint8(1,J),V.setUint8(2,0),V.setUint8(3,$),V.setUint8(4,Z),V.setUint8(5,W),V.setUint32(6,X,!0);for(let Y=0;Y<64;Y++){let P=K[Y]||{hue:0,saturation:0,brightness:0,kelvin:0},z=10+Y*8;V.setUint16(z,P.hue,!0),V.setUint16(z+2,P.saturation,!0),V.setUint16(z+4,P.brightness,!0),V.setUint16(z+6,P.kelvin,!0)}return F}function hJ(){let Q=new Uint8Array(2);return Q[0]=0,Q[1]=0,Q}function mJ(Q,J,$,Z,W,X,K,F){let V=new Uint8Array(188),Y=new DataView(V.buffer);Y.setUint8(0,0),Y.setUint8(1,0),Y.setUint32(2,Q,!0),Y.setUint8(6,J),Y.setUint32(7,$,!0),Y.setBigUint64(11,Z,!0),Y.setUint32(19,0),Y.setUint32(23,0),Y.setUint8(27,W),Y.setUint8(28,0),Y.setUint8(29,0),Y.setUint8(30,0),Y.setUint8(31,X),Y.setUint32(32,0),Y.setUint32(35,0),Y.setUint32(51,0),Y.setUint32(55,0),Y.setUint8(59,K);for(let P=0;P<16;P++){let z=F[P]||{hue:0,saturation:0,brightness:0,kelvin:0},G=60+P*8;Y.setUint16(G,z.hue,!0),Y.setUint16(G+2,z.saturation,!0),Y.setUint16(G+4,z.brightness,!0),Y.setUint16(G+6,z.kelvin,!0)}return V}function T(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint16(J.current,!0);J.current+=2;let W=$.getUint16(J.current,!0);J.current+=2;let X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);J.current+=2;let F=q(Q,J,2),V=$.getUint16(J.current,!0);J.current+=2;let Y=x(Q,J,32),P=q(Q,J,8);return{hue:Z,saturation:W,brightness:X,kelvin:K,power:V,label:Y,reserved2:F,reserved8:P}}function h(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,Z}function l(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,Z}function y(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint32(J.current,!0);J.current+=4;let W=$.getUint32(J.current,!0);J.current+=4;let X=!!$.getUint8(J.current);return J.current+=1,{duration_s:Z,remaining_s:W,last_power:X}}function R(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint32(J.current,!0);return J.current+=4,{indication:Z,duration_s:W}}function gJ(Q,J){let $=Q[J.current];return J.current+=1,$}function d(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint16(J.current,!0);return J.current+=2,{relay_index:Z,level:W}}function wJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=[];for(let K=0;K<16;K++){let F=$.getInt16(J.current,!0);J.current+=2;let V=$.getInt16(J.current,!0);J.current+=2;let Y=$.getInt16(J.current,!0);J.current+=2;let P=q(Q,J,2),z=$.getFloat32(J.current,!0);J.current+=4;let G=$.getFloat32(J.current,!0);J.current+=4;let D=$.getUint8(J.current);J.current+=1;let C=$.getUint8(J.current);J.current+=1;let L=q(Q,J,1),B=$.getUint32(J.current,!0);J.current+=4;let H=$.getUint32(J.current,!0);J.current+=4;let A=q(Q,J,4),O=M(Q,J),I=q(Q,J,8),g=$.getUint16(J.current,!0);J.current+=2;let w=$.getUint16(J.current,!0);J.current+=2;let aJ=q(Q,J,4);W.push({accel_meas_x:F,accel_meas_y:V,accel_meas_z:Y,reserved6:P,user_x:z,user_y:G,width:D,height:C,reserved7:L,device_version_vendor:B,device_version_product:H,reserved8:A,firmware_build:O,reserved9:I,firmware_version_minor:g,firmware_version_major:w,reserved10:aJ})}let X=$.getUint8(J.current);return J.current+=1,{start_index:Z,devices:W,tile_devices_count:X}}function bJ(Q,J){let $=Q[J.current];J.current+=1;let Z=q(Q,J,1),W=Q[J.current];J.current+=1;let X=Q[J.current];J.current+=1;let K=Q[J.current];J.current+=1;let F=new DataView(Q.buffer,Q.byteOffset),V=[];for(let Y=0;Y<64;Y++){let P=F.getUint16(J.current,!0);J.current+=2;let z=F.getUint16(J.current,!0);J.current+=2;let G=F.getUint16(J.current,!0);J.current+=2;let D=F.getUint16(J.current,!0);J.current+=2,V.push({hue:P,saturation:z,brightness:G,kelvin:D})}return{tile_index:$,reserved6:Z,x:W,y:X,width:K,colors:V}}function EQ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint8(J.current);J.current+=1;let X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);J.current+=2;let F=$.getUint16(J.current,!0);J.current+=2;let V=$.getUint16(J.current,!0);return J.current+=2,{zones_count:Z,zone_index:W,hue:X,saturation:K,brightness:F,kelvin:V}}function n(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint8(J.current);J.current+=1;let X=[];for(let K=0;K<8;K++){let F=$.getUint16(J.current,!0);J.current+=2;let V=$.getUint16(J.current,!0);J.current+=2;let Y=$.getUint16(J.current,!0);J.current+=2;let P=$.getUint16(J.current,!0);J.current+=2,X.push({hue:F,saturation:V,brightness:Y,kelvin:P})}return{zones_count:Z,zone_index:W,colors:X}}function a(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint32(J.current,!0);J.current+=4;let W=$.getUint8(J.current);J.current+=1;let X=q(Q,J,2),K=$.getUint32(J.current,!0);J.current+=4;let F=$.getBigUint64(J.current,!0);J.current+=8;let V=q(Q,J,4),Y=q(Q,J,4),P=q(Q,J,32);return{instanceid:Z,type:W,reserved6:X,speed:K,duration:F,reserved7:V,reserved8:Y,parameters:P}}function r(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint16(J.current,!0);J.current+=2;let W=$.getUint16(J.current,!0);J.current+=2;let X=$.getUint8(J.current);J.current+=1;let K=[];for(let F=0;F<82;F++){let V=$.getUint16(J.current,!0);J.current+=2;let Y=$.getUint16(J.current,!0);J.current+=2;let P=$.getUint16(J.current,!0);J.current+=2;let z=$.getUint16(J.current,!0);J.current+=2,K.push({hue:V,saturation:Y,brightness:P,kelvin:z})}return{zones_count:Z,zone_index:W,colors_count:X,colors:K}}function i(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),Z=$.getUint8(J.current);J.current+=1;let W=$.getUint32(J.current,!0);J.current+=4;let X=$.getUint8(J.current);J.current+=1;let K=$.getUint32(J.current,!0);J.current+=4;let F=$.getBigUint64(J.current,!0);J.current+=8;let V=q(Q,J,4),Y=q(Q,J,4),P=$.getUint8(J.current);J.current+=1;let z=q(Q,J,3),G=$.getUint8(J.current);J.current+=1;let D=q(Q,J,3),C=$.getUint8(J.current);J.current+=1;let L=q(Q,J,23),B=$.getUint8(J.current);J.current+=1;let H=[];for(let A=0;A<16;A++){let O=$.getUint16(J.current,!0);J.current+=2;let I=$.getUint16(J.current,!0);J.current+=2;let g=$.getUint16(J.current,!0);J.current+=2;let w=$.getUint16(J.current,!0);J.current+=2,H.push({hue:O,saturation:I,brightness:g,kelvin:w})}return{reserved0:Z,instanceid:W,type:X,speed:K,duration:F,reserved1:V,reserved2:Y,skyType:P,reserved3:z,cloudSaturationMin:G,reserved4:D,cloudSaturationMax:C,reserved5:L,palette_count:B,palette:H}}function pJ(Q,J){let Z=new DataView(Q.buffer,Q.byteOffset).getFloat32(J.current,!0);return J.current+=4,{lux:Z}}var tJ=(Q,J=0)=>Q.getUint16(J,!0),cJ=(Q,J=0)=>Q.getUint16(J+2,!0),IQ=(Q,J=0)=>!!(cJ(Q,J)>>12&1),sJ=(Q,J=0)=>Q.getUint32(J+4,!0),fJ=(Q,J=0)=>Q.subarray(J+8,J+14),eJ=(Q,J=0)=>Q.getUint8(J+22),JQ=(Q)=>(Q&1)>0,QQ=(Q)=>(Q&2)>0,$Q=(Q,J=0)=>Q.getUint16(J+32,!0),ZQ=(Q,J=0)=>Q.getUint8(J+23),uJ=(Q,J=0)=>Q.subarray(J+36);function vJ(Q,J=0){let $=new DataView(Q.buffer,Q.byteOffset),Z=tJ($,J),W=cJ($,J),X=W&4095,K=!!(W>>12&1),F=!!(W>>13&1),V=W>>14&3,Y=sJ($,J),P=fJ(Q,J),z=Q.subarray(J+14,J+16),G=Q.subarray(J+16,J+22),D=eJ($,J),C=JQ(D),L=QQ(D),B=(D&252)>>2,H=ZQ($,J),A=Q.subarray(J+24,J+32),O=$Q($,J),I=Q.subarray(J+34,J+36);return{bytes:Q.subarray(0,36),size:Z,protocol:X,addressable:K,tagged:F,origin:V,source:Y,target:P,reserved1:z,reserved2:G,res_required:C,ack_required:L,reserved3:B,reserved4:A,sequence:H,reserved5:I,type:O}}var E=(Q)=>{};function m(){let Q=E,J=E,$=new Promise((Z,W)=>{Q=Z,J=W});return{resolve:Q,reject:J,promise:$}}function VQ(Q,J,$){Q=Q*6/65535,J=J/65535,$=$*255/65535;let Z=Math.floor(Q),W=Q-Z,X=$*(1-J),K=$*(1-J*W),F=$*(1-J*(1-W)),V,Y,P;switch(Z){case 0:V=$,Y=F,P=X;break;case 1:V=K,Y=$,P=X;break;case 2:V=X,Y=$,P=F;break;case 3:V=X,Y=K,P=$;break;case 4:V=F,Y=X,P=$;break;default:V=$,Y=X,P=K}return[Math.round(V),Math.round(Y),Math.round(P)]}function YQ(Q,J,$){Q/=255,J/=255,$/=255;let Z=Math.max(Q,J,$),W=Z-Math.min(Q,J,$),X=W===0?0:W&&Z===Q?(J-$)/W:Z===J?2+($-Q)/W:4+(Q-J)/W;return[Math.round(60*(X<0?X+6:X)*182.04166666666666),Math.round(Z&&W/Z*65535),Math.round(Z*65535)]}function KQ(Q){if(Q===200)return"none";if(Q<-80||Q===4||Q===5||Q===6)return"very bad";if(Q<-70||Q>=7&&Q<=11)return"somewhat bad";if(Q<-60||Q>=12&&Q<=16)return"alright";if(Q<0||Q>16)return"good";return"none"}function XQ(Q){return Math.floor(10*Math.log10(Q)+0.5)}function lJ(Q){let J="",{length:$}=Q;for(let Z=0;Z<$;Z++){let W=Q[Z].toString(16);if(W.length<2)J+="0"+W;else J+=W}return J}function yJ(Q){if(Q.length!==12)throw new Error("Invalid serial number");let J=new Uint8Array(6);for(let $=0;$<6;$++){let Z=2*$;J[$]=parseInt(Q.slice(Z,Z+2),16)}return J}class j extends Error{constructor(Q,J={}){super(Q);if(this.name=this.constructor.name,this.context=J,Error.captureStackTrace)Error.captureStackTrace(this,this.constructor)}toJSON(){return{name:this.name,message:this.message,context:this.context,stack:this.stack}}}class o extends j{constructor(Q,J="operation"){super(`${J} timed out after ${Q}ms`);this.timeoutMs=Q,this.operation=J}}class t extends j{constructor(Q,J){super(`Device ${J||"unknown"} returned unhandled command type: ${Q}`);this.commandType=Q,this.deviceSerial=J}}class s extends j{constructor(Q,J){super(`Message routing conflict for key: ${Q}`);this.key=Q,this.source=J}}class f extends j{constructor(){super("No more source IDs available. Consider disposing unused clients.")}}class FQ extends j{constructor(Q){super(`Cannot use disposed client with source ${Q}`);this.source=Q}}class _ extends j{constructor(Q,J,$){super(`Invalid ${Q}: ${J}${$?` (${$})`:""}`);this.parameter=Q,this.value=J,this.reason=$}}var RJ=4294967295,PQ=RJ-2;function TQ(Q){let J=Q.handlers??new Map,$=2;return{nextSource(){let Z=-1;for(let W=0;W<PQ;W++){if(!J.has($)){Z=$;break}if($=($+1)%4294967296,$<=1)$=2}if(Z===-1)throw new f;return Z},register(Z,W){if(Z<=1||Z>RJ)throw new _("source",Z,"must be between 2 and 4294967295");if(J.has(Z))throw new _("source",Z,"already registered");J.set(Z,W)},deregister(Z,W){if(J.get(Z)!==W)throw new _("messageHandler",W,"does not match registered handler");J.delete(Z)},send(Z,W,X,K){Q.onSend(Z,W,X,K)},receive(Z){let W=vJ(Z),X=uJ(Z),K=lJ(W.target),F=J.get(W.source);if(F)F(W,X,K);if(Q.onMessage)Q.onMessage(W,X,K);return{header:W,payload:X,serialNumber:K}}}}function nJ(Q,J){return`${Q}:${J}`}function e(Q){return Q==null?0:(Q+1)%255}function dJ(Q,J,$,Z,W,X,K){let F=nJ(J,$);if(X.has(F))throw new s(F,$);let{resolve:V,reject:Y,promise:P}=m();function z(C){if(X.delete(F),C instanceof Error)Y(C);else Y(new Error("Operation aborted"))}let G;if(K)K.addEventListener("abort",z,{once:!0});else if(W>0)G=setTimeout(()=>z(new o(W,"device response")),W);function D(){if(K)K.removeEventListener("abort",z);else clearTimeout(G);X.delete(F)}return X.set(F,(C,L,B)=>{if(C===U.Acknowledgement){if(Q)D(),V(void 0);return}if(D(),C===U.StateUnhandled){let H=UJ(L,B);Y(new t(H,J));return}if(!Q&&Z)V(Z(L,B))}),P}function pQ(Q){let J=Q.source??Q.router.nextSource(),$=Q.defaultTimeoutMs??3000,{router:Z}=Q,W=new Map,X=!1,K={get router(){return Z},get source(){return J},dispose(){if(X)return;X=!0,Z.deregister(J,K.onMessage)},broadcast(F){let V=S(!0,J,k,!1,!1,255,F.type,F.payload);Z.send(V,N,JJ)},unicast(F,V){let Y=S(!1,J,V.target,!1,!1,V.sequence,F.type,F.payload);Z.send(Y,V.port,V.address,V.serialNumber),V.sequence=e(V.sequence)},sendOnlyAcknowledgement(F,V,Y){let P=S(!1,J,V.target,!1,!0,V.sequence,F.type,F.payload),z=dJ(!0,V.serialNumber,V.sequence,void 0,$,W,Y);return V.sequence=e(V.sequence),Z.send(P,V.port,V.address,V.serialNumber),z},send(F,V,Y){let P=S(!1,J,V.target,!0,!1,V.sequence,F.type,F.payload),z=dJ(!1,V.serialNumber,V.sequence,F.decode,$,W,Y);return V.sequence=e(V.sequence),Z.send(P,V.port,V.address,V.serialNumber),z},onMessage(F,V,Y){if(Q.onMessage)Q.onMessage(F,V,Y);let P=W.get(nJ(Y,F.sequence));if(P)P(F.type,V,{current:0})}};return Z.register(J,K.onMessage),K}function lQ(){return{type:U.GetService,decode:WJ}}function yQ(){return{type:U.GetHostFirmware,decode:VJ}}function RQ(){return{type:U.GetWifiInfo,decode:YJ}}function dQ(){return{type:U.GetWifiFirmware,decode:KJ}}function nQ(){return{type:U.GetPower,decode:p}}function aQ(Q){return{type:U.SetPower,payload:GJ(Q),decode:p}}function rQ(){return{type:U.GetLabel,decode:c}}function iQ(Q){return{type:U.SetLabel,payload:$J(Q,32),decode:c}}function oQ(){return{type:U.GetVersion,decode:XJ}}function tQ(){return{type:U.GetInfo,decode:FJ}}function sQ(){return{type:U.SetReboot,decode:E}}function fQ(){return{type:U.GetLocation,decode:u}}function eQ(Q,J,$){return{type:U.SetLocation,payload:DJ(Q,J,$),decode:u}}function J0(){return{type:U.GetGroup,decode:v}}function Q0(Q,J,$){return{type:U.SetGroup,payload:CJ(Q,J,$),decode:v}}function $0(Q){return{type:U.EchoRequest,payload:qJ(Q),decode:PJ}}function Z0(){return{type:U.GetColor,decode:T}}function W0(Q,J,$,Z,W){return{type:U.SetColor,payload:zJ(Q,J,$,Z,W),decode:T}}function V0(Q,J,$,Z,W,X,K,F,V){return{type:U.SetWaveform,payload:LJ(Q,J,$,Z,W,X,K,F,V),decode:T}}function Y0(){return{type:U.GetLightPower,decode:h}}function K0(Q,J){return{type:U.SetLightPower,payload:BJ(Q,J),decode:h}}function X0(Q,J,$,Z,W,X,K,F,V,Y,P,z,G){return{type:U.SetWaveformOptional,payload:HJ(Q,J,$,Z,W,X,K,F,V,Y,P,z,G),decode:h}}function F0(){return{type:U.GetInfrared,decode:l}}function P0(Q){return{type:U.SetInfrared,payload:AJ(Q),decode:l}}function U0(){return{type:U.GetHevCycle,decode:y}}function z0(Q,J){return{type:U.SetHevCycle,payload:OJ(Q,J),decode:y}}function G0(){return{type:U.GetHevCycleConfiguration,decode:R}}function D0(Q,J){return{type:U.SetHevCycleConfiguration,payload:MJ(Q,J),decode:R}}function C0(){return{type:U.GetLastHevCycleResult,decode:gJ}}function q0(Q){return{type:U.GetRPower,payload:jJ(Q),decode:d}}function L0(Q,J){return{type:U.SetRPower,payload:EJ(Q,J),decode:d}}function B0(){return{type:U.GetDeviceChain,decode:wJ}}function H0(Q,J,$,Z,W){return{type:U.Get64,payload:IJ(Q,J,$,Z,W),decode:bJ}}function A0(Q,J){return{type:U.GetColorZones,payload:SJ(Q,J),decode:n}}function O0(Q,J,$,Z,W,X,K,F){return{type:U.SetColorZones,payload:_J(Q,J,$,Z,W,X,K,F),decode:n}}function M0(){return{type:U.GetMultiZoneEffect,decode:a}}function j0(Q,J,$,Z,W){return{type:U.SetMultiZoneEffect,payload:NJ(Q,J,$,Z,W),decode:a}}function E0(){return{type:U.GetExtendedColorZones,decode:r}}function I0(Q,J,$,Z,W){return{type:U.SetExtendedColorZones,payload:kJ(Q,J,$,Z,W),decode:r}}function S0(Q,J,$){return{type:U.SetUserPosition,payload:xJ(Q,J,$),decode:E}}function _0(Q,J,$,Z,W,X,K){return{type:U.Set64,payload:TJ(Q,J,$,Z,W,X,K),decode:E}}function N0(){return{type:U.GetTileEffect,payload:hJ(),decode:i}}function k0(Q,J,$,Z,W,X,K,F){return{type:U.SetTileEffect,payload:mJ(Q,J,$,Z,W,X,K,F),decode:i}}function x0(){return{type:U.SensorGetAmbientLight,decode:pJ}}function UQ(Q){return Q.port??=N,Q.target??=Q.serialNumber?yJ(Q.serialNumber):k,Q.sequence=0,Q}function g0(Q){let J=Q?.defaultTimeoutMs??3000,$=Q?.onAdded,Z=Q?.onChanged,W=Q?.onRemoved,X=new Map,K=new Map;function F(V,Y,P,z){let G=X.get(V);if(G){if(Y!==G.port||P!==G.address){if(G.port=Y,G.address=P,Z)Z(G)}return G}let D=UQ({serialNumber:V,port:Y,address:P,target:z});if(X.set(V,D),$)$(D);return D}return{get registered(){return X},register(V,Y,P,z){let G=F(V,Y,P,z),D=K.get(V);if(D)K.delete(V),D.forEach((C)=>{C(G)});return G},remove(V){let Y=X.get(V),P=X.delete(V);if(Y&&W)W(Y);return P},get(V,Y){let P=X.get(V);if(P)return Promise.resolve(P);let{resolve:z,reject:G,promise:D}=m();function C(A){let O=K.get(V);if(O)if(O.size>1)O.delete(z);else K.delete(V);G(A instanceof Error?A:new Error("Abort"))}let L;if(Y)Y.addEventListener("abort",C,{once:!0});else L=setTimeout(()=>C(new Error("Timeout")),J);let B=(A)=>{if(Y)Y.removeEventListener("abort",C);else clearTimeout(L);z(A)},H=K.get(V);if(!H)K.set(V,new Set([B]));else H.add(B);return D}}}function b0(Q){let J=Q?.onAdded,$=Q?.onChanged,Z=Q?.onRemoved,W=new Map;function X(F){let V=W.get(F);if(V){if(W.delete(F),Z)Z(V)}}function K(F,V){for(let Y=0;Y<F.devices.length;Y+=1)if(F.devices[Y]===V)return Y;return-1}return{register(F,V){let Y=W.get(V.group);if(Y){if(K(Y,F)<0){if(Y.devices.push(F),$)$(Y)}}else{let P={label:V.label,uuid:V.group,devices:[F]};if(W.set(V.group,P),J)J(P)}},remove(F){X(F)},removeDevice(F){W.forEach((V)=>{let Y=K(V,F);if(Y>=0){if(V.devices[Y]=V.devices[V.devices.length-1],V.devices.pop(),V.devices.length===0)X(V.uuid);else if($)$(V)}})},get registered(){return W}}}export{YQ as rgbToHsb,VQ as hsbToRgb,KQ as getRssiStatus,uJ as getPayload,$Q as getHeaderType,fJ as getHeaderTarget,IQ as getHeaderTagged,sJ as getHeaderSource,tJ as getHeaderSize,ZQ as getHeaderSequence,JQ as getHeaderResponseRequired,eJ as getHeaderResponseFlags,cJ as getHeaderFlags,QQ as getHeaderAcknowledgeRequired,QJ as encodeUuidTo,ZJ as encodeTimestampTo,b as encodeStringTo,$J as encodeString,HJ as encodeSetWaveformOptional,LJ as encodeSetWaveform,xJ as encodeSetUserPosition,mJ as encodeSetTileEffect,EJ as encodeSetRPower,GJ as encodeSetPower,NJ as encodeSetMultiZoneEffect,DJ as encodeSetLocation,BJ as encodeSetLightPower,AJ as encodeSetInfrared,MJ as encodeSetHevCycleConfiguration,OJ as encodeSetHevCycle,CJ as encodeSetGroup,kJ as encodeSetExtendedColorZones,_J as encodeSetColorZones,zJ as encodeSetColor,TJ as encodeSet64,hJ as encodeGetTileEffect,jJ as encodeGetRPower,SJ as encodeGetColorZones,IJ as encodeGet64,qJ as encodeEchoRequest,S as encode,EQ as decodeStateZone,YJ as decodeStateWifiInfo,KJ as decodeStateWifiFirmware,XJ as decodeStateVersion,UJ as decodeStateUnhandled,i as decodeStateTileEffect,WJ as decodeStateService,d as decodeStateRPower,p as decodeStatePower,a as decodeStateMultiZoneEffect,n as decodeStateMultiZone,u as decodeStateLocation,h as decodeStateLightPower,gJ as decodeStateLastHevCycleResult,c as decodeStateLabel,l as decodeStateInfrared,FJ as decodeStateInfo,VJ as decodeStateHostFirmware,R as decodeStateHevCycleConfiguration,y as decodeStateHevCycle,v as decodeStateGroup,r as decodeStateExtendedColorZones,wJ as decodeStateDeviceChain,bJ as decodeState64,jQ as decodeSetColor,pJ as decodeSensorStateAmbientLight,T as decodeLightState,vJ as decodeHeader,PJ as decodeEchoResponse,XQ as convertSignalToRssi,OQ as Waveform,_ as ValidationError,t as UnhandledCommandError,U as Type,o as TimeoutError,HQ as TileEffectType,AQ as TileEffectSkyType,f as SourceExhaustionError,X0 as SetWaveformOptionalCommand,V0 as SetWaveformCommand,S0 as SetUserPositionCommand,k0 as SetTileEffectCommand,sQ as SetRebootCommand,L0 as SetRPowerCommand,aQ as SetPowerCommand,j0 as SetMultiZoneEffectCommand,eQ as SetLocationCommand,K0 as SetLightPowerCommand,iQ as SetLabelCommand,P0 as SetInfraredCommand,D0 as SetHevCycleConfigurationCommand,z0 as SetHevCycleCommand,Q0 as SetGroupCommand,I0 as SetExtendedColorZonesCommand,O0 as SetColorZonesCommand,W0 as SetColorCommand,_0 as Set64Command,GQ as ServiceType,x0 as SensorGetAmbientLightCommand,TQ as Router,zQ as PRODUCTS_URL,N as PORT,k as NO_TARGET,BQ as MultiZoneExtendedApplicationRequest,LQ as MultiZoneEffectType,qQ as MultiZoneApplicationRequest,s as MessageConflictError,CQ as LightLastHevCycleResult,j as LifxError,b0 as Groups,RQ as GetWifiInfoCommand,dQ as GetWifiFirmwareCommand,oQ as GetVersionCommand,N0 as GetTileEffectCommand,lQ as GetServiceCommand,q0 as GetRPowerCommand,nQ as GetPowerCommand,M0 as GetMultiZoneEffectCommand,fQ as GetLocationCommand,Y0 as GetLightPowerCommand,C0 as GetLastHevCycleResultCommand,rQ as GetLabelCommand,F0 as GetInfraredCommand,tQ as GetInfoCommand,yQ as GetHostFirmwareCommand,G0 as GetHevCycleConfigurationCommand,U0 as GetHevCycleCommand,J0 as GetGroupCommand,E0 as GetExtendedColorZonesCommand,B0 as GetDeviceChainCommand,A0 as GetColorZonesCommand,Z0 as GetColorCommand,H0 as Get64Command,$0 as EchoRequestCommand,FQ as DisposedClientError,DQ as Direction,g0 as Devices,UQ as Device,pQ as Client,JJ as BROADCAST_ADDRESS};
