var j=56700,e="255.255.255.255",oJ="https://raw.githubusercontent.com/LIFX/products/master/products.json",T=new Uint8Array([0,0,0,0,0,0]),tJ={UDP:1,RESERVED2:2,RESERVED3:3,RESERVED4:4,RESERVED5:5},fJ={RIGHT:0,LEFT:1};var sJ={SUCCESS:0,BUSY:1,INTERRUPTED_BY_RESET:2,INTERRUPTED_BY_HOMEKIT:3,INTERRUPTED_BY_LAN:4,INTERRUPTED_BY_CLOUD:5,NONE:255},eJ={SAW:0,SINE:1,HALF_SINE:2,TRIANGLE:3,PULSE:4};var JQ={NO_APPLY:0,APPLY:1,APPLY_ONLY:2},QQ={OFF:0,MOVE:1,RESERVED1:2,RESERVED2:3},$Q={NO_APPLY:0,APPLY:1,APPLY_ONLY:2};var WQ={OFF:0,RESERVED1:1,MORPH:2,FLAME:3,RESERVED2:4,SKY:5},VQ={SUNRISE:0,SUNSET:1,CLOUDS:2};var G={GetService:2,StateService:3,GetHostFirmware:14,StateHostFirmware:15,GetWifiInfo:16,StateWifiInfo:17,GetWifiFirmware:18,StateWifiFirmware:19,GetPower:20,SetPower:21,StatePower:22,GetLabel:23,SetLabel:24,StateLabel:25,GetVersion:32,StateVersion:33,GetInfo:34,StateInfo:35,SetReboot:38,Acknowledgement:45,GetLocation:48,SetLocation:49,StateLocation:50,GetGroup:51,SetGroup:52,StateGroup:53,EchoRequest:58,EchoResponse:59,StateUnhandled:223,GetColor:101,SetColor:102,SetWaveform:103,LightState:107,GetLightPower:116,SetLightPower:117,StateLightPower:118,SetWaveformOptional:119,GetInfrared:120,StateInfrared:121,SetInfrared:122,GetHevCycle:142,SetHevCycle:143,StateHevCycle:144,GetHevCycleConfiguration:145,SetHevCycleConfiguration:146,StateHevCycleConfiguration:147,GetLastHevCycleResult:148,StateLastHevCycleResult:149,SetColorZones:501,GetColorZones:502,StateZone:503,StateMultiZone:506,GetMultiZoneEffect:507,SetMultiZoneEffect:508,StateMultiZoneEffect:509,SetExtendedColorZones:510,GetExtendedColorZones:511,StateExtendedColorZones:512,GetRPower:816,SetRPower:817,StateRPower:818,GetDeviceChain:701,StateDeviceChain:702,SetUserPosition:703,Get64:707,State64:711,Set64:715,GetTileEffect:718,SetTileEffect:719,StateTileEffect:720,SensorGetAmbientLight:401,SensorStateAmbientLight:402};function L(Q,J,$,W,V,X,K,F){let z=36+(F!=null?F.byteLength:0),D=new Uint8Array(z),C=new DataView(D.buffer,D.byteOffset);if(C.setUint16(0,z,!0),C.setUint16(2,5120|+Q<<13|0,!0),C.setUint32(4,J,!0),D.set($,8),C.setUint8(22,(W?1:0)<<0|(V?1:0)<<1),C.setUint8(23,X),C.setUint16(32,K,!0),F)D.set(F,36);return D}function cJ(Q,J,$){let W=$.replace(/-/g,"");for(let V=0,X=0;V<W.length;V+=2,X++)Q[J+X]=parseInt(W.slice(V,V+2),16)}var YQ=new TextEncoder;function JJ(Q,J,$,W){if(YQ.encodeInto($,Q.subarray(J)),$.length<W)Q[J+$.length]=0}function QJ(Q,J){let $=new Uint8Array(J);return JJ($,0,Q,J),$}function H(Q,J,$){let W=Q.subarray(J.current,J.current+$);return J.current+=$,W}function ZQ(Q,J){return Array.from(H(Q,J,16)).map(($)=>$.toString(16).padStart(2,"0")).join("")}var KQ=new TextDecoder;function w(Q,J,$){let W=Q.subarray(J.current,J.current+$).findIndex((K)=>K===0),V=W>=0?W:$,X=KQ.decode(Q.subarray(J.current,J.current+V));return J.current+=$,X}function yJ(Q,J,$){Q.setBigUint64(J,BigInt($.getTime())*1000000n,!0)}function _(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=new Date(Number($.getBigUint64(J.current,!0)/1000000n));return J.current+=8,W}function $J(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint32(J.current,!0);return J.current+=4,{service:W,port:V}}function WJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=_(Q,J),V=H(Q,J,8),X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);return J.current+=2,{build:W,reserved:V,version_minor:X,version_major:K}}function VJ(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getFloat32(J.current,!0);J.current+=4;let V=H(Q,J,4),X=H(Q,J,4),K=H(Q,J,2);return{signal:W,reserved6:V,reserved7:X,reserved8:K}}function YJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset,Q.byteLength),W=_(Q,J),V=H(Q,J,8),X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);return J.current+=2,{build:W,reserved6:V,version_minor:X,version_major:K}}function g(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,W}function b(Q,J){return w(Q,J,32)}function ZJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint32(J.current,!0);J.current+=4;let V=$.getUint32(J.current,!0);return J.current+=4,{vendor:W,product:V}}function KJ(Q,J){let $=_(Q,J),W=_(Q,J),V=_(Q,J);return{time:$,uptime:W,downtime:V}}function u(Q,J){let $=H(Q,J,16),W=w(Q,J,32),V=_(Q,J);return{location:$,label:W,updated_at:V}}function v(Q,J){let $=ZQ(Q,J),W=w(Q,J,32),X=new DataView(Q.buffer,Q.byteOffset).getBigUint64(J.current,!0);return J.current+=8,{group:$,label:W,updated_at:X}}function XJ(Q,J){return H(Q,J,64)}function pJ(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,W}function FJ(Q,J,$,W,V){let X=new Uint8Array(13),K=new DataView(X.buffer);return K.setUint16(1,Q,!0),K.setUint16(3,J,!0),K.setUint16(5,$,!0),K.setUint16(7,W,!0),K.setUint32(9,V,!0),X}function PJ(Q){let J=new Uint8Array(2);return new DataView(J.buffer).setUint16(0,typeof Q==="number"?Q:Q?65535:0,!0),J}function GJ(Q,J,$){let W=new Uint8Array(56),V=new DataView(W.buffer);if(typeof Q==="string")cJ(W,0,Q);else W.set(Q,0);return JJ(W,16,J,32),yJ(V,48,$),W}function zJ(Q,J,$){let W=new Uint8Array(56),V=new DataView(W.buffer);if(typeof Q==="string")cJ(W,0,Q);else W.set(Q,0);return JJ(W,16,J,32),yJ(V,48,$),W}function DJ(Q){let J=new Uint8Array(64);return J.set(Q),J}function CJ(Q,J,$,W,V,X,K,F,Y){let Z=new Uint8Array(21),P=new DataView(Z.buffer);return Z[1]=Q?1:0,P.setUint16(2,J,!0),P.setUint16(4,$,!0),P.setUint16(6,W,!0),P.setUint16(8,V,!0),P.setUint32(10,X,!0),P.setFloat32(14,K,!0),P.setInt16(18,F,!0),P.setUint8(20,Y),Z}function qJ(Q,J){let $=new Uint8Array(6),W=new DataView($.buffer),V=typeof Q==="number"?Q:Q?65535:0;return W.setUint16(0,V,!0),W.setUint32(2,J,!0),$}function HJ(Q,J,$,W,V,X,K,F,Y,Z,P,z,D){let C=new Uint8Array(25),q=new DataView(C.buffer);return C[1]=Q?1:0,q.setUint16(2,J,!0),q.setUint16(4,$,!0),q.setUint16(6,W,!0),q.setUint16(8,V,!0),q.setUint32(10,X,!0),q.setFloat32(14,K,!0),q.setInt16(18,F,!0),q.setUint8(20,Y),C[21]=Z?1:0,C[22]=P?1:0,C[23]=z?1:0,C[24]=D?1:0,C}function BJ(Q){let J=new Uint8Array(2);return new DataView(J.buffer).setUint16(0,Q,!0),J}function AJ(Q,J){let $=new Uint8Array(5),W=new DataView($.buffer);return W.setUint8(0,Q?1:0),W.setUint32(1,J,!0),$}function UJ(Q,J){let $=new Uint8Array(5),W=new DataView($.buffer);return W.setUint8(0,Q?1:0),W.setUint32(1,J,!0),$}function OJ(Q){let J=new Uint8Array(1);return new DataView(J.buffer).setUint8(0,Q),J}function EJ(Q,J){let $=new Uint8Array(3),W=new DataView($.buffer);return W.setUint8(0,Q),W.setUint16(1,J,!0),$}function IJ(Q,J,$,W,V){let X=new Uint8Array(6),K=new DataView(X.buffer);return K.setUint8(0,Q),K.setUint8(1,J),K.setUint8(2,0),K.setUint8(3,$),K.setUint8(4,W),K.setUint8(5,V),X}function SJ(Q,J){let $=new Uint8Array(2),W=new DataView($.buffer);return W.setUint8(0,Q),W.setUint8(1,J),$}function _J(Q,J,$,W,V,X,K,F){let Y=new Uint8Array(15),Z=new DataView(Y.buffer);return Z.setUint8(0,Q),Z.setUint8(1,J),Z.setUint16(2,$,!0),Z.setUint16(4,W,!0),Z.setUint16(6,V,!0),Z.setUint16(8,X,!0),Z.setUint32(10,K,!0),Z.setUint8(14,F),Y}function LJ(Q,J,$,W,V){let X=new Uint8Array(59),K=new DataView(X.buffer);return K.setUint32(0,Q,!0),K.setUint8(4,J),K.setUint8(5,0),K.setUint8(6,0),K.setUint32(7,$,!0),K.setBigUint64(11,W,!0),K.setUint32(19,0),K.setUint32(23,0),X.set(V.slice(0,32),27),X}function NJ(Q,J,$,W,V){let X=new Uint8Array(664),K=new DataView(X.buffer);K.setUint32(0,Q,!0),K.setUint8(4,J),K.setUint16(5,$,!0),K.setUint8(7,W);for(let F=0;F<82;F++){let Y=V[F]||{hue:0,saturation:0,brightness:0,kelvin:0},Z=8+F*8;K.setUint16(Z,Y.hue,!0),K.setUint16(Z+2,Y.saturation,!0),K.setUint16(Z+4,Y.brightness,!0),K.setUint16(Z+6,Y.kelvin,!0)}return X}function MJ(Q,J,$){let W=new Uint8Array(11),V=new DataView(W.buffer);return V.setUint8(0,Q),V.setUint8(1,0),V.setUint8(2,0),V.setFloat32(3,J,!0),V.setFloat32(7,$,!0),W}function kJ(Q,J,$,W,V,X,K){let F=new Uint8Array(522),Y=new DataView(F.buffer);Y.setUint8(0,Q),Y.setUint8(1,J),Y.setUint8(2,0),Y.setUint8(3,$),Y.setUint8(4,W),Y.setUint8(5,V),Y.setUint32(6,X,!0);for(let Z=0;Z<64;Z++){let P=K[Z]||{hue:0,saturation:0,brightness:0,kelvin:0},z=10+Z*8;Y.setUint16(z,P.hue,!0),Y.setUint16(z+2,P.saturation,!0),Y.setUint16(z+4,P.brightness,!0),Y.setUint16(z+6,P.kelvin,!0)}return F}function jJ(){let Q=new Uint8Array(2);return Q[0]=0,Q[1]=0,Q}function TJ(Q,J,$,W,V,X,K,F){let Y=new Uint8Array(188),Z=new DataView(Y.buffer);Z.setUint8(0,0),Z.setUint8(1,0),Z.setUint32(2,Q,!0),Z.setUint8(6,J),Z.setUint32(7,$,!0),Z.setBigUint64(11,W,!0),Z.setUint32(19,0),Z.setUint32(23,0),Z.setUint8(27,V),Z.setUint8(28,0),Z.setUint8(29,0),Z.setUint8(30,0),Z.setUint8(31,X),Z.setUint32(32,0),Z.setUint32(35,0),Z.setUint32(51,0),Z.setUint32(55,0),Z.setUint8(59,K);for(let P=0;P<16;P++){let z=F[P]||{hue:0,saturation:0,brightness:0,kelvin:0},D=60+P*8;Z.setUint16(D,z.hue,!0),Z.setUint16(D+2,z.saturation,!0),Z.setUint16(D+4,z.brightness,!0),Z.setUint16(D+6,z.kelvin,!0)}return Y}function x(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint16(J.current,!0);J.current+=2;let V=$.getUint16(J.current,!0);J.current+=2;let X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);J.current+=2;let F=H(Q,J,2),Y=$.getUint16(J.current,!0);J.current+=2;let Z=w(Q,J,32),P=H(Q,J,8);return{hue:W,saturation:V,brightness:X,kelvin:K,power:Y,label:Z,reserved2:F,reserved8:P}}function h(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,W}function c(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getUint16(J.current,!0);return J.current+=2,W}function y(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint32(J.current,!0);J.current+=4;let V=$.getUint32(J.current,!0);J.current+=4;let X=!!$.getUint8(J.current);return J.current+=1,{duration_s:W,remaining_s:V,last_power:X}}function p(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint32(J.current,!0);return J.current+=4,{indication:W,duration_s:V}}function xJ(Q,J){let $=Q[J.current];return J.current+=1,$}function l(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint16(J.current,!0);return J.current+=2,{relay_index:W,level:V}}function hJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=[];for(let K=0;K<16;K++){let F=$.getInt16(J.current,!0);J.current+=2;let Y=$.getInt16(J.current,!0);J.current+=2;let Z=$.getInt16(J.current,!0);J.current+=2;let P=H(Q,J,2),z=$.getFloat32(J.current,!0);J.current+=4;let D=$.getFloat32(J.current,!0);J.current+=4;let C=$.getUint8(J.current);J.current+=1;let q=$.getUint8(J.current);J.current+=1;let A=H(Q,J,1),O=$.getUint32(J.current,!0);J.current+=4;let B=$.getUint32(J.current,!0);J.current+=4;let U=H(Q,J,4),E=_(Q,J),k=H(Q,J,8),f=$.getUint16(J.current,!0);J.current+=2;let s=$.getUint16(J.current,!0);J.current+=2;let iJ=H(Q,J,4);V.push({accel_meas_x:F,accel_meas_y:Y,accel_meas_z:Z,reserved6:P,user_x:z,user_y:D,width:C,height:q,reserved7:A,device_version_vendor:O,device_version_product:B,reserved8:U,firmware_build:E,reserved9:k,firmware_version_minor:f,firmware_version_major:s,reserved10:iJ})}let X=$.getUint8(J.current);return J.current+=1,{start_index:W,devices:V,tile_devices_count:X}}function mJ(Q,J){let $=Q[J.current];J.current+=1;let W=H(Q,J,1),V=Q[J.current];J.current+=1;let X=Q[J.current];J.current+=1;let K=Q[J.current];J.current+=1;let F=new DataView(Q.buffer,Q.byteOffset),Y=[];for(let Z=0;Z<64;Z++){let P=F.getUint16(J.current,!0);J.current+=2;let z=F.getUint16(J.current,!0);J.current+=2;let D=F.getUint16(J.current,!0);J.current+=2;let C=F.getUint16(J.current,!0);J.current+=2,Y.push({hue:P,saturation:z,brightness:D,kelvin:C})}return{tile_index:$,reserved6:W,x:V,y:X,width:K,colors:Y}}function lJ(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint8(J.current);J.current+=1;let X=$.getUint16(J.current,!0);J.current+=2;let K=$.getUint16(J.current,!0);J.current+=2;let F=$.getUint16(J.current,!0);J.current+=2;let Y=$.getUint16(J.current,!0);return J.current+=2,{zones_count:W,zone_index:V,hue:X,saturation:K,brightness:F,kelvin:Y}}function R(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint8(J.current);J.current+=1;let X=[];for(let K=0;K<8;K++){let F=$.getUint16(J.current,!0);J.current+=2;let Y=$.getUint16(J.current,!0);J.current+=2;let Z=$.getUint16(J.current,!0);J.current+=2;let P=$.getUint16(J.current,!0);J.current+=2,X.push({hue:F,saturation:Y,brightness:Z,kelvin:P})}return{zones_count:W,zone_index:V,colors:X}}function d(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint32(J.current,!0);J.current+=4;let V=$.getUint8(J.current);J.current+=1;let X=H(Q,J,2),K=$.getUint32(J.current,!0);J.current+=4;let F=$.getBigUint64(J.current,!0);J.current+=8;let Y=H(Q,J,4),Z=H(Q,J,4),P=H(Q,J,32);return{instanceid:W,type:V,reserved6:X,speed:K,duration:F,reserved7:Y,reserved8:Z,parameters:P}}function a(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint16(J.current,!0);J.current+=2;let V=$.getUint16(J.current,!0);J.current+=2;let X=$.getUint8(J.current);J.current+=1;let K=[];for(let F=0;F<82;F++){let Y=$.getUint16(J.current,!0);J.current+=2;let Z=$.getUint16(J.current,!0);J.current+=2;let P=$.getUint16(J.current,!0);J.current+=2;let z=$.getUint16(J.current,!0);J.current+=2,K.push({hue:Y,saturation:Z,brightness:P,kelvin:z})}return{zones_count:W,zone_index:V,colors_count:X,colors:K}}function n(Q,J){let $=new DataView(Q.buffer,Q.byteOffset),W=$.getUint8(J.current);J.current+=1;let V=$.getUint32(J.current,!0);J.current+=4;let X=$.getUint8(J.current);J.current+=1;let K=$.getUint32(J.current,!0);J.current+=4;let F=$.getBigUint64(J.current,!0);J.current+=8;let Y=H(Q,J,4),Z=H(Q,J,4),P=$.getUint8(J.current);J.current+=1;let z=H(Q,J,3),D=$.getUint8(J.current);J.current+=1;let C=H(Q,J,3),q=$.getUint8(J.current);J.current+=1;let A=H(Q,J,23),O=$.getUint8(J.current);J.current+=1;let B=[];for(let U=0;U<16;U++){let E=$.getUint16(J.current,!0);J.current+=2;let k=$.getUint16(J.current,!0);J.current+=2;let f=$.getUint16(J.current,!0);J.current+=2;let s=$.getUint16(J.current,!0);J.current+=2,B.push({hue:E,saturation:k,brightness:f,kelvin:s})}return{reserved0:W,instanceid:V,type:X,speed:K,duration:F,reserved1:Y,reserved2:Z,skyType:P,reserved3:z,cloudSaturationMin:D,reserved4:C,cloudSaturationMax:q,reserved5:A,palette_count:O,palette:B}}function wJ(Q,J){let W=new DataView(Q.buffer,Q.byteOffset).getFloat32(J.current,!0);return J.current+=4,{lux:W}}var XQ=(Q,J=0)=>Q.getUint16(J,!0),FQ=(Q,J=0)=>Q.getUint16(J+2,!0);var PQ=(Q,J=0)=>Q.getUint32(J+4,!0),GQ=(Q,J=0)=>Q.subarray(J+8,J+14),zQ=(Q,J=0)=>Q.getUint8(J+22),DQ=(Q)=>(Q&1)>0,CQ=(Q)=>(Q&2)>0,qQ=(Q,J=0)=>Q.getUint16(J+32,!0),HQ=(Q,J=0)=>Q.getUint8(J+23),RJ=(Q,J=0)=>Q.subarray(J+36);function gJ(Q,J=0){let $=new DataView(Q.buffer,Q.byteOffset),W=XQ($,J),V=FQ($,J),X=V&4095,K=!!(V>>12&1),F=!!(V>>13&1),Y=V>>14&3,Z=PQ($,J),P=GQ(Q,J),z=Q.subarray(J+14,J+16),D=Q.subarray(J+16,J+22),C=zQ($,J),q=DQ(C),A=CQ(C),O=(C&252)>>2,B=HQ($,J),U=Q.subarray(J+24,J+32),E=qQ($,J),k=Q.subarray(J+34,J+36);return{bytes:Q.subarray(0,36),size:W,protocol:X,addressable:K,tagged:F,origin:Y,source:Z,target:P,reserved1:z,reserved2:D,res_required:q,ack_required:A,reserved3:O,reserved4:U,sequence:B,reserved5:k,type:E}}var I=(Q)=>{};function m(){let Q=I,J=I,$=new Promise((W,V)=>{Q=W,J=V});return{resolve:Q,reject:J,promise:$}}function BQ(Q){if(Q===200)return"none";if(Q<-80||Q===4||Q===5||Q===6)return"very bad";if(Q<-70||Q>=7&&Q<=11)return"somewhat bad";if(Q<-60||Q>=12&&Q<=16)return"alright";if(Q<0||Q>16)return"good";return"none"}function AQ(Q){return Math.floor(10*Math.log10(Q)+0.5)}function bJ(Q){let J="",{length:$}=Q;for(let W=0;W<$;W++){let V=Q[W].toString(16);if(V.length<2)J+="0"+V;else J+=V}return J}function uJ(Q){if(Q.length!==12)throw new Error("Invalid serial number");let J=new Uint8Array(6);for(let $=0;$<6;$++){let W=2*$;J[$]=parseInt(Q.slice(W,W+2),16)}return J}function UQ(Q,J,$){Q=Q*6/65535,J=J/65535,$=$*255/65535;let W=Math.floor(Q),V=Q-W,X=$*(1-J),K=$*(1-J*V),F=$*(1-J*(1-V)),Y,Z,P;switch(W){case 0:Y=$,Z=F,P=X;break;case 1:Y=K,Z=$,P=X;break;case 2:Y=X,Z=$,P=F;break;case 3:Y=X,Z=K,P=$;break;case 4:Y=F,Z=X,P=$;break;default:Y=$,Z=X,P=K}return[Math.round(Y),Math.round(Z),Math.round(P)]}function OQ(Q,J,$){Q/=255,J/=255,$/=255;let W=Math.max(Q,J,$),V=W-Math.min(Q,J,$),X=V===0?0:V&&W===Q?(J-$)/V:W===J?2+($-Q)/V:4+(Q-J)/V;return[Math.round(60*(X<0?X+6:X)*182.04166666666666),Math.round(W&&V/W*65535),Math.round(W*65535)]}class S extends Error{context;constructor(Q,J={}){super(Q);if(this.name=this.constructor.name,this.context=J,Error.captureStackTrace)Error.captureStackTrace(this,this.constructor)}toJSON(){return{name:this.name,message:this.message,context:this.context,stack:this.stack}}}class r extends S{timeoutMs;operation;constructor(Q,J="operation"){super(`${J} timed out after ${Q}ms`);this.timeoutMs=Q,this.operation=J}}class i extends S{commandType;deviceSerial;constructor(Q,J){super(`Device ${J||"unknown"} returned unhandled command type: ${Q}`);this.commandType=Q,this.deviceSerial=J}}class o extends S{key;source;constructor(Q,J){super(`Message routing conflict for key: ${Q}`);this.key=Q,this.source=J}}class t extends S{constructor(){super("No more source IDs available. Consider disposing unused clients.")}}class dJ extends S{source;constructor(Q){super(`Cannot use disposed client with source ${Q}`);this.source=Q}}class M extends S{parameter;value;reason;constructor(Q,J,$){super(`Invalid ${Q}: ${J}${$?` (${$})`:""}`);this.parameter=Q,this.value=J,this.reason=$}}var aJ=4294967295,EQ=aJ-2;function IQ(Q){let J=Q.handlers??new Map,$=2;return{nextSource(){let W=-1;for(let V=0;V<EQ;V++){if(!J.has($)){W=$;break}if($=($+1)%4294967296,$<=1)$=2}if(W===-1)throw new t;return W},register(W,V){if(W<=1||W>aJ)throw new M("source",W,"must be between 2 and 4294967295");if(J.has(W))throw new M("source",W,"already registered");J.set(W,V)},deregister(W,V){if(J.get(W)!==V)throw new M("messageHandler",V,"does not match registered handler");J.delete(W)},send(W,V,X,K){Q.onSend(W,V,X,K)},receive(W){let V=gJ(W),X=RJ(W),K=bJ(V.target),F=J.get(V.source);if(F)F(V,X,K);if(Q.onMessage)Q.onMessage(V,X,K);return{header:V,payload:X,serialNumber:K}}}}function rJ(Q,J){return`${Q}:${J}`}function vJ(Q){return Q==null?0:(Q+1)%255}function nJ(Q,J,$,W,V,X,K){let F=rJ(J,$);if(X.has(F))throw new o(F,$);let{resolve:Y,reject:Z,promise:P}=m();function z(q){if(X.delete(F),q instanceof Error)Z(q);else Z(new Error("Operation aborted"))}let D;if(K)K.addEventListener("abort",z,{once:!0});else if(V>0)D=setTimeout(()=>z(new r(V,"device response")),V);function C(){if(K)K.removeEventListener("abort",z);else if(D)clearTimeout(D);X.delete(F)}return X.set(F,(q,A,O)=>{if(q===G.Acknowledgement){if(Q)C(),Y(void 0);return}if(q===G.StateUnhandled){C();let B=pJ(A,O);Z(new i(B,J));return}if(!Q&&W){let B={expectMore:!1},U=W.length>=4?W(A,O,B,q):W(A,O,B);if(B.expectMore)return;else C(),Y(U)}}),P}function SQ(Q){let J=Q.source??Q.router.nextSource(),$=Q.defaultTimeoutMs??3000,{router:W}=Q,V=new Map,X=!1,K={get router(){return W},get source(){return J},dispose(){if(X)return;X=!0,W.deregister(J,K.onMessage)},broadcast(F){let Y=L(!0,J,T,!1,!1,255,F.type,F.payload);W.send(Y,j,e)},unicast(F,Y){let Z=L(!1,J,Y.target,!1,!1,Y.sequence,F.type,F.payload);W.send(Z,Y.port,Y.address,Y.serialNumber),Y.sequence=vJ(Y.sequence)},sendOnlyAcknowledgement(F,Y,Z){let P=L(!1,J,Y.target,!1,!0,Y.sequence,F.type,F.payload),z=nJ(!0,Y.serialNumber,Y.sequence,void 0,$,V,Z);return Y.sequence=vJ(Y.sequence),W.send(P,Y.port,Y.address,Y.serialNumber),z},send(F,Y,Z){let P=L(!1,J,Y.target,!0,!1,Y.sequence,F.type,F.payload),z=nJ(!1,Y.serialNumber,Y.sequence,F.decode,$,V,Z);return Y.sequence=vJ(Y.sequence),W.send(P,Y.port,Y.address,Y.serialNumber),z},onMessage(F,Y,Z){if(Q.onMessage)Q.onMessage(F,Y,Z);let P=V.get(rJ(Z,F.sequence));if(P)P(F.type,Y,{current:0})}};return W.register(J,K.onMessage),K}function _Q(){return{type:G.GetService,decode:$J}}function LQ(){return{type:G.GetHostFirmware,decode:WJ}}function NQ(){return{type:G.GetWifiInfo,decode:VJ}}function MQ(){return{type:G.GetWifiFirmware,decode:YJ}}function kQ(){return{type:G.GetPower,decode:g}}function jQ(Q){return{type:G.SetPower,payload:PJ(Q),decode:g}}function TQ(){return{type:G.GetLabel,decode:b}}function xQ(Q){return{type:G.SetLabel,payload:QJ(Q,32),decode:b}}function hQ(){return{type:G.GetVersion,decode:ZJ}}function mQ(){return{type:G.GetInfo,decode:KJ}}function wQ(){return{type:G.SetReboot,decode:I}}function gQ(){return{type:G.GetLocation,decode:u}}function bQ(Q,J,$){return{type:G.SetLocation,payload:GJ(Q,J,$),decode:u}}function uQ(){return{type:G.GetGroup,decode:v}}function vQ(Q,J,$){return{type:G.SetGroup,payload:zJ(Q,J,$),decode:v}}function cQ(Q){return{type:G.EchoRequest,payload:DJ(Q),decode:XJ}}function yQ(){return{type:G.GetColor,decode:x}}function pQ(Q,J,$,W,V){return{type:G.SetColor,payload:FJ(Q,J,$,W,V),decode:x}}function lQ(Q,J,$,W,V,X,K,F,Y){return{type:G.SetWaveform,payload:CJ(Q,J,$,W,V,X,K,F,Y),decode:x}}function RQ(){return{type:G.GetLightPower,decode:h}}function dQ(Q,J){return{type:G.SetLightPower,payload:qJ(Q,J),decode:h}}function aQ(Q,J,$,W,V,X,K,F,Y,Z,P,z,D){return{type:G.SetWaveformOptional,payload:HJ(Q,J,$,W,V,X,K,F,Y,Z,P,z,D),decode:h}}function nQ(){return{type:G.GetInfrared,decode:c}}function rQ(Q){return{type:G.SetInfrared,payload:BJ(Q),decode:c}}function iQ(){return{type:G.GetHevCycle,decode:y}}function oQ(Q,J){return{type:G.SetHevCycle,payload:AJ(Q,J),decode:y}}function tQ(){return{type:G.GetHevCycleConfiguration,decode:p}}function fQ(Q,J){return{type:G.SetHevCycleConfiguration,payload:UJ(Q,J),decode:p}}function sQ(){return{type:G.GetLastHevCycleResult,decode:xJ}}function eQ(Q,J,$){let W=new Set;for(let K=Q;K<=J;K++)W.add(K);let V=[],X=(K,F,Y,Z)=>{let P;if(Z===G.StateZone)P=lJ(K,F),W.delete(P.zone_index);else if(Z===G.StateMultiZone){P=R(K,F);for(let z=0;z<P.colors.length;z++)W.delete(P.zone_index+z)}if(Y)if(P){V.push(P);let z=!0;if($)z=$(P)!==!1;Y.expectMore=z&&W.size>0}else Y.expectMore=W.size>0;return V};return{type:G.GetColorZones,payload:SJ(Q,J),decode:X}}function J0(Q,J,$,W,V,X,K,F){return{type:G.SetColorZones,payload:_J(Q,J,$,W,V,X,K,F),decode:R}}function Q0(){return{type:G.GetMultiZoneEffect,decode:d}}function $0(Q,J,$,W,V){return{type:G.SetMultiZoneEffect,payload:LJ(Q,J,$,W,V),decode:d}}function W0(){return{type:G.GetExtendedColorZones,decode:a}}function V0(Q,J,$,W,V){return{type:G.SetExtendedColorZones,payload:NJ(Q,J,$,W,V),decode:a}}function Y0(){return{type:G.GetDeviceChain,decode:hJ}}function Z0(Q,J,$,W,V){return{type:G.Get64,payload:IJ(Q,J,$,W,V),decode:mJ}}function K0(Q,J,$){return{type:G.SetUserPosition,payload:MJ(Q,J,$),decode:I}}function X0(Q,J,$,W,V,X,K){return{type:G.Set64,payload:kJ(Q,J,$,W,V,X,K),decode:I}}function F0(){return{type:G.GetTileEffect,payload:jJ(),decode:n}}function P0(Q,J,$,W,V,X,K,F){return{type:G.SetTileEffect,payload:TJ(Q,J,$,W,V,X,K,F),decode:n}}function G0(Q){return{type:G.GetRPower,payload:OJ(Q),decode:l}}function z0(Q,J){return{type:G.SetRPower,payload:EJ(Q,J),decode:l}}function D0(){return{type:G.SensorGetAmbientLight,decode:wJ}}function C0(Q){let J=Q;return J.port??=j,J.target??=Q.serialNumber?uJ(Q.serialNumber):T,J.sequence=0,J}function q0(Q={}){let J=Q.defaultTimeoutMs??3000,$=Q.onAdded,W=Q.onChanged,V=Q.onRemoved,X=new Map,K=new Map;function F(Y,Z,P,z){let D=X.get(Y);if(D){if(Z!==D.port||P!==D.address){if(D.port=Z,D.address=P,W)W(D)}return D}let C=C0(z?{serialNumber:Y,port:Z,address:P,target:z}:{serialNumber:Y,port:Z,address:P});if(X.set(Y,C),$)$(C);return C}return{get registered(){return X},register(Y,Z,P,z){let D=F(Y,Z,P,z),C=K.get(Y);if(C)K.delete(Y),C.forEach((q)=>{q(D)});return D},remove(Y){let Z=X.get(Y),P=X.delete(Y);if(Z&&V)V(Z);return P},get(Y,Z){let P=X.get(Y);if(P)return Promise.resolve(P);let{resolve:z,reject:D,promise:C}=m();function q(U){let E=K.get(Y);if(E)if(E.size>1)E.delete(z);else K.delete(Y);D(U instanceof Error?U:new Error("Abort"))}let A;if(Z)Z.addEventListener("abort",q,{once:!0});else A=setTimeout(()=>q(new Error("Timeout")),J);let O=(U)=>{if(Z)Z.removeEventListener("abort",q);else if(A)clearTimeout(A);z(U)},B=K.get(Y);if(!B)K.set(Y,new Set([O]));else B.add(O);return C}}}function H0(Q={}){let{onAdded:J,onChanged:$,onRemoved:W}=Q,V=new Map;function X(F){let Y=V.get(F);if(Y){if(V.delete(F),W)W(Y)}}function K(F,Y){for(let Z=0;Z<F.devices.length;Z+=1)if(F.devices[Z]===Y)return Z;return-1}return{register(F,Y){let Z=V.get(Y.group);if(Z){if(K(Z,F)<0){if(Z.devices.push(F),$)$(Z)}}else{let P={label:Y.label,uuid:Y.group,devices:[F]};if(V.set(Y.group,P),J)J(P)}},remove(F){X(F)},removeDevice(F){V.forEach((Y)=>{let Z=K(Y,F);if(Z>=0){if(Y.devices[Z]=Y.devices[Y.devices.length-1],Y.devices.pop(),Y.devices.length===0)X(Y.uuid);else if($)$(Y)}})},get registered(){return V}}}export{OQ as rgbToHsb,UQ as hsbToRgb,BQ as getRssiStatus,QJ as encodeString,HJ as encodeSetWaveformOptional,CJ as encodeSetWaveform,MJ as encodeSetUserPosition,TJ as encodeSetTileEffect,EJ as encodeSetRPower,PJ as encodeSetPower,LJ as encodeSetMultiZoneEffect,GJ as encodeSetLocation,qJ as encodeSetLightPower,BJ as encodeSetInfrared,UJ as encodeSetHevCycleConfiguration,AJ as encodeSetHevCycle,zJ as encodeSetGroup,NJ as encodeSetExtendedColorZones,_J as encodeSetColorZones,FJ as encodeSetColor,kJ as encodeSet64,jJ as encodeGetTileEffect,OJ as encodeGetRPower,SJ as encodeGetColorZones,IJ as encodeGet64,DJ as encodeEchoRequest,L as encode,VJ as decodeStateWifiInfo,YJ as decodeStateWifiFirmware,ZJ as decodeStateVersion,n as decodeStateTileEffect,$J as decodeStateService,l as decodeStateRPower,g as decodeStatePower,d as decodeStateMultiZoneEffect,R as decodeStateMultiZone,u as decodeStateLocation,h as decodeStateLightPower,xJ as decodeStateLastHevCycleResult,b as decodeStateLabel,c as decodeStateInfrared,KJ as decodeStateInfo,WJ as decodeStateHostFirmware,p as decodeStateHevCycleConfiguration,y as decodeStateHevCycle,v as decodeStateGroup,a as decodeStateExtendedColorZones,hJ as decodeStateDeviceChain,mJ as decodeState64,wJ as decodeSensorStateAmbientLight,x as decodeLightState,gJ as decodeHeader,XJ as decodeEchoResponse,bJ as convertTargetToSerialNumber,AQ as convertSignalToRssi,uJ as convertSerialNumberToTarget,eJ as Waveform,M as ValidationError,i as UnhandledCommandError,G as Type,r as TimeoutError,WQ as TileEffectType,VQ as TileEffectSkyType,t as SourceExhaustionError,aQ as SetWaveformOptionalCommand,lQ as SetWaveformCommand,K0 as SetUserPositionCommand,P0 as SetTileEffectCommand,wQ as SetRebootCommand,z0 as SetRPowerCommand,jQ as SetPowerCommand,$0 as SetMultiZoneEffectCommand,bQ as SetLocationCommand,dQ as SetLightPowerCommand,xQ as SetLabelCommand,rQ as SetInfraredCommand,fQ as SetHevCycleConfigurationCommand,oQ as SetHevCycleCommand,vQ as SetGroupCommand,V0 as SetExtendedColorZonesCommand,J0 as SetColorZonesCommand,pQ as SetColorCommand,X0 as Set64Command,tJ as ServiceType,D0 as SensorGetAmbientLightCommand,IQ as Router,m as PromiseWithResolvers,oJ as PRODUCTS_URL,j as PORT,T as NO_TARGET,I as NOOP,$Q as MultiZoneExtendedApplicationRequest,QQ as MultiZoneEffectType,JQ as MultiZoneApplicationRequest,o as MessageConflictError,sJ as LightLastHevCycleResult,S as LifxError,H0 as Groups,NQ as GetWifiInfoCommand,MQ as GetWifiFirmwareCommand,hQ as GetVersionCommand,F0 as GetTileEffectCommand,_Q as GetServiceCommand,G0 as GetRPowerCommand,kQ as GetPowerCommand,Q0 as GetMultiZoneEffectCommand,gQ as GetLocationCommand,RQ as GetLightPowerCommand,sQ as GetLastHevCycleResultCommand,TQ as GetLabelCommand,nQ as GetInfraredCommand,mQ as GetInfoCommand,LQ as GetHostFirmwareCommand,tQ as GetHevCycleConfigurationCommand,iQ as GetHevCycleCommand,uQ as GetGroupCommand,W0 as GetExtendedColorZonesCommand,Y0 as GetDeviceChainCommand,eQ as GetColorZonesCommand,yQ as GetColorCommand,Z0 as Get64Command,cQ as EchoRequestCommand,dJ as DisposedClientError,fJ as Direction,q0 as Devices,SQ as Client,e as BROADCAST_ADDRESS};
